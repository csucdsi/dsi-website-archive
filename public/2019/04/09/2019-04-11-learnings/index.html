<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>At DataFest 2019, I Learned... &middot; </title>
        <meta name="description" content="Introduction During CSU, Chico&rsquo;s DataFest 2019, two questions from different teams provided me (Edward, not Dr. Donatello) an excellent learning experience. This blog post attempts to describe the problems these teams faced and then offer up some solutions. This post is about my own learnings during DataFest and does not even pretend to claim that these are the only, nor the best, solutions to these problems.
Team Re(sps) The physics team asked me about transforming multiple, specific columns within a Python $\texttt{pandas.">
        <meta name="HandheldFriendly" content="True">
        <meta name="MobileOptimized" content="320">
        <meta name="generator" content="Hugo 0.75.1" />
        <meta name="robots" content="index,follow">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <link rel="stylesheet" href="/dist/styles.css">
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
        
        
    </head>
    <body>
        
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-122708636-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


        <div id="wrapper">
            <header class="site-header">
                <div class="container">
                    <div class="site-title-wrapper">
                        
                            <h1 class="site-title">
                                <a title="CSUC DSI" href="/">CSUC DSI</a>
                            </h1>
                        
                        <a class="button-square" href="/index.xml"><i class="fa fa-rss"></i></a>
                        
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Github" title="Github" href="https://github.com/csucdsi">
                                <i class="fa fa-github-alt"></i>
                            </a>
                        
                        
                        
                        
                        
                            <a class="button-square button-social hint--top" data-hint="Email" title="Email" href="mailto:datascience@csuchico.edu">
                                <i class="fa fa-envelope"></i>
                            </a>
                        
                    </div>

                    <ul class="site-nav">
                        
    <li class="site-nav-item">
        <a title="News" href="/">News</a>
    </li>

    <li class="site-nav-item">
        <a title="About" href="/page/about/">About</a>
    </li>

    <li class="site-nav-item">
        <a title="Training" href="/page/courses/">Training</a>
    </li>

    <li class="site-nav-item">
        <a title="Calendar" href="/page/events/">Calendar</a>
    </li>

    <li class="site-nav-item">
        <a title="Contact" href="/page/contact/">Contact</a>
    </li>

                    </ul>
                </div>
            </header>

            <div id="container">


<div class="container">
    <article class="post-container" itemscope="" itemtype="http://schema.org/BlogPosting">
        <header class="post-header">
    <h1 class="post-title" itemprop="name headline">At DataFest 2019, I Learned...</h1>
    
    <p class="post-date">
        <span>Published <time datetime="2019-04-09" itemprop="datePublished">Tue, Apr 9, 2019</time></span>
        <span>by</span>
        <span itemscope="" itemprop="author" itemtype="https://schema.org/Person">
            <span itemprop="name">
                <a href="#" itemprop="url" rel="author">Edward A. Roualdes</a>
            </span>
        </span>
    </p>
</header>

        <div class="post-content clearfix" itemprop="articleBody">
    

    <h1 id="introduction">Introduction</h1>
<p>During <a href="https://csudsi.netlify.com/2019/02/17/2019-02-17-asa-datafest-2019/">CSU, Chico&rsquo;s DataFest 2019</a>, two questions from different teams provided me (Edward, not Dr. Donatello) an excellent learning experience.  This blog post attempts to describe the problems these teams faced and then offer up some solutions.  This post is about my own learnings during DataFest and does not even pretend to claim that these are the only, nor the best, solutions to these problems.</p>
<h1 id="team-resps">Team Re(sps)</h1>
<p>The physics team asked me about transforming multiple, specific columns within a Python $\texttt{pandas.DataFrame.groupby}$ operation.  It took me a minute, but here&rsquo;s what I came up with.  Three specific variables are standardized and then checked to ensure that the correct thing happened.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd

<span style="color:#75715e"># setup</span>
df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#34;~/data/finches.csv&#34;</span>)
vars <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;winglength&#39;</span>, <span style="color:#e6db74">&#39;taillength&#39;</span>, <span style="color:#e6db74">&#39;middletoelength&#39;</span>]
zvars <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;z&#39;</span> <span style="color:#f92672">+</span> x <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> vars]

<span style="color:#75715e"># solution</span>
df[zvars] <span style="color:#f92672">=</span> df<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#39;island&#39;</span>)[vars]<span style="color:#f92672">.</span>transform(<span style="color:#66d9ef">lambda</span> x: (x <span style="color:#f92672">-</span> x<span style="color:#f92672">.</span>mean())<span style="color:#f92672">/</span>x<span style="color:#f92672">.</span>std())

<span style="color:#75715e"># check</span>
df<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#39;island&#39;</span>)[zvars]<span style="color:#f92672">.</span>agg({<span style="color:#e6db74">&#39;mean&#39;</span>, <span style="color:#e6db74">&#39;std&#39;</span>})
</code></pre></div><pre><code>##                zwinglength        ztaillength      zmiddletoelength     
##                       mean  std          mean  std             mean  std
## island                                                                  
## floreana     -8.710981e-16  1.0 -6.148928e-16  1.0    -1.340808e-15  1.0
## sancristobal  1.513193e-15  1.0  1.940834e-15  1.0    -1.233581e-15  1.0
## santacruz    -7.401487e-16  1.0 -4.144833e-16  1.0    -1.657933e-15  1.0
</code></pre><h2 id="team-data-strikes-back">Team Data Strikes Back</h2>
<p>Team Data Strikes Back wanted to number the levels of a categorical variable.  Here&rsquo;s some made up data to represent the idea.  Our goal is to index the levels of $f$.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#a6e22e">suppressMessages</span>(<span style="color:#a6e22e">library</span>(dplyr))
df <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">tibble</span>(f <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#66d9ef">letters</span>, <span style="color:#ae81ff">20</span>, replace<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>))
</code></pre></div><p>The solution I came up with relies on sorting the data, so let&rsquo;s do that first.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">o <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">order</span>(df<span style="color:#f92672">$</span>f)
df <span style="color:#f92672">&lt;-</span> df[o,,drop<span style="color:#f92672">=</span><span style="color:#66d9ef">FALSE</span>]
df<span style="color:#f92672">$</span>nf <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">match</span>(df<span style="color:#f92672">$</span>f, <span style="color:#a6e22e">unique</span>(df<span style="color:#f92672">$</span>f))

<span style="color:#75715e"># check</span>
<span style="color:#a6e22e">head</span>(df)
</code></pre></div><pre><code>## # A tibble: 6 x 2
##   f        nf
##   &lt;chr&gt; &lt;int&gt;
## 1 a         1
## 2 d         2
## 3 g         3
## 4 g         3
## 5 g         3
## 6 i         4
</code></pre><p>Surely there&rsquo;s other ways to do this; R <del>probably</del> has a function for it.  But I <del>don&rsquo;t</del> didn&rsquo;t know which function.  Moreover, this solution is general enough to be used within a broader grouping variable $g$ and does not require any variable to be a factor.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">number_levels <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x) {
  x <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">sort</span>(x)
  <span style="color:#a6e22e">match</span>(x, <span style="color:#a6e22e">unique</span>(x))
}
df<span style="color:#f92672">$</span>g <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">gl</span>(<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, labels<span style="color:#f92672">=</span><span style="color:#a6e22e">sample</span>(<span style="color:#66d9ef">LETTERS</span>, <span style="color:#ae81ff">4</span>)))

df <span style="color:#f92672">&lt;-</span> df <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(g) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">mutate</span>(gf <span style="color:#f92672">=</span> <span style="color:#a6e22e">number_levels</span>(f))
</code></pre></div><p>It requires some extra work if you want the numbered levels to be increasing across the levels of some grouping variable $g$, but we can manage with some help from a rarely used assignment operator.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">index_grouped_levels <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>() {
  idx <span style="color:#f92672">&lt;-</span> <span style="color:#ae81ff">0</span>
  nl <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">function</span>(x) {
    levels <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">number_levels</span>(x) <span style="color:#f92672">+</span> idx
    idx <span style="color:#f92672">&lt;&lt;-</span> <span style="color:#a6e22e">max</span>(levels)
    levels
  }
  nl
}

igrp_levels <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">index_grouped_levels</span>()
df <span style="color:#f92672">&lt;-</span> df <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">arrange</span>(g, f) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(g) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">mutate</span>(ngf <span style="color:#f92672">=</span> <span style="color:#a6e22e">igrp_levels</span>(f))
</code></pre></div><h3 id="a-simpler-solution">A Simpler Solution</h3>
<p>On the Tuesday after DataFest, I show off my work to Dr. Donatello, and she looks at me like I&rsquo;m crazy.  She says, &ldquo;What about $\texttt{as.numeric(f)}$ called on a factor?&rdquo;  I respond, &ldquo;Ffa, sha, wha?&rdquo;  Then she shows me, and we worked out this gem.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">df <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">tibble</span>(f <span style="color:#f92672">=</span> <span style="color:#a6e22e">sample</span>(<span style="color:#66d9ef">letters</span>, <span style="color:#ae81ff">20</span>, replace<span style="color:#f92672">=</span><span style="color:#66d9ef">TRUE</span>))
df<span style="color:#f92672">$</span>g <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">as.character</span>(<span style="color:#a6e22e">gl</span>(<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>, labels<span style="color:#f92672">=</span><span style="color:#a6e22e">sample</span>(<span style="color:#66d9ef">LETTERS</span>, <span style="color:#ae81ff">4</span>)))

<span style="color:#75715e"># as.numeric() on a concatenated factor</span>
df <span style="color:#f92672">&lt;-</span> df <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">arrange</span>(<span style="color:#a6e22e">desc</span>(g), f) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">mutate</span>(gf <span style="color:#f92672">=</span> <span style="color:#a6e22e">paste0</span>(g, f)) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">mutate</span>(mgf <span style="color:#f92672">=</span> <span style="color:#a6e22e">as.numeric</span>(<span style="color:#a6e22e">as.factor</span>(gf)))

<span style="color:#75715e"># my strategy</span>
igrp_levels <span style="color:#f92672">&lt;-</span> <span style="color:#a6e22e">index_grouped_levels</span>()
df <span style="color:#f92672">&lt;-</span> df <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">group_by</span>(g) <span style="color:#f92672">%&gt;%</span>
  <span style="color:#a6e22e">mutate</span>(ngf <span style="color:#f92672">=</span> <span style="color:#a6e22e">igrp_levels</span>(f))

<span style="color:#a6e22e">all</span>(df<span style="color:#f92672">$</span>mgf <span style="color:#f92672">==</span> df<span style="color:#f92672">$</span>ngf)
</code></pre></div><pre><code>## [1] TRUE
</code></pre><h1 id="conclusion">Conclusion</h1>
<p>Dr. D&rsquo;s solution is much simpler, but at least I came up with a solution and learned something along the way.  DataFest 2019 was great, and it&rsquo;s my opinion that all involved gained a lot from the event. Thanks, Dr. D.</p>

</div>

        <footer class="post-footer clearfix">
    

    <div class="share">
        
            <a class="icon-twitter" href="https://twitter.com/share?text=At%20DataFest%202019%2c%20I%20Learned...&url=%2f2019%2f04%2f09%2f2019-04-11-learnings%2f"
                onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                <i class="fa fa-twitter"></i>
                <span class="hidden">Twitter</span>
            </a>
        

        
            <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=%2f2019%2f04%2f09%2f2019-04-11-learnings%2f"
                onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                <i class="fa fa-facebook"></i>
                <span class="hidden">Facebook</span>
            </a>
        

        
            <a class="icon-google-plus" href="https://plus.google.com/share?url=%2f2019%2f04%2f09%2f2019-04-11-learnings%2f"
              onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
              <i class="fa fa-google-plus"></i>
                <span class="hidden">Google+</span>
            </a>
        
        
    </div>
</footer>

        
    <div class="comments">
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "XXX" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>

    </article>
</div>

            </div>
        </div>

        <footer class="footer">
            <div class="container">
                <div class="site-title-wrapper">
                    <h1 class="site-title">
                        <a title="CSUC DSI" href="/">CSUC DSI</a>
                    </h1>
                    <a class="button-square button-jump-top js-jump-top" href="#">
                        <i class="fa fa-angle-up"></i>
                    </a>
                </div>

                <p class="footer-copyright">
                    <span>&copy; 2020 / Powered by <a href="https://gohugo.io/">Hugo</a></span>
                </p>
                <p class="footer-copyright">
                    <span><a href="https://github.com/roryg/ghostwriter">Ghostwriter theme</a> By <a href="http://jollygoodthemes.com">JollyGoodThemes</a></span>
                    <span>/ <a href="https://github.com/jbub/ghostwriter">Ported</a> to Hugo By <a href="https://github.com/jbub">jbub</a></span>
                </p>
            </div>
        </footer>

        <script src="/js/jquery-1.11.3.min.js"></script>
        <script src="/js/jquery.fitvids.js"></script>
        
        
            <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        
        
        <script src="/js/scripts.js"></script>
   

    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
          processEscapes: true
        },
        "HTML-CSS": { fonts: ["TeX"] }
      });
    </script>
    <script type="text/javascript" async
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>



    </body>
</html>


  
